# 菜单和主题功能测试检查清单

**测试日期**: 2026-02-11
**测试人员**: Bug-fixer / Tester
**测试版本**: 主题系统重构后
**相关文件**:
- `windows/theme-window.html` (重构)
- `src/app-vanilla.js` (API 检查)
- `src/theme-manager.js` (主题管理)

---

## 📋 测试环境检查

- [ ] Node.js 已安装
- [ ] npm 依赖已安装 (`npm install`)
- [ ] 应用正常启动 (`npm start`)
- [ ] 无数据库错误（如果有警告可忽略）
- [ ] 控制台无严重错误

---

## 🎯 测试 1: 菜单功能测试

### 1.1 打开径向菜单
**步骤**:
1. 启动应用
2. 点击宠物图标
3. 观察菜单弹出

**预期结果**:
- [ ] 径向菜单平滑弹出
- [ ] 菜单项清晰可见
- [ ] 无控制台错误
- [ ] 菜单位置正确（围绕宠物）

**实际结果**: _____________

**备注**: _____________

### 1.2 点击"主题"按钮
**步骤**:
1. 确保菜单已打开
2. 点击"主题"（🎨 图标）
3. 观察主题窗口打开

**预期结果**:
- [ ] 菜单自动关闭
- [ ] 主题窗口平滑打开
- [ ] 窗口位置合理（不超出屏幕）
- [ ] 窗口标题显示 "🎨 切换主题"
- [ ] 无控制台错误

**实际结果**: _____________

**备注**: _____________

### 1.3 其他菜单按钮
**步骤**:
重复测试以下菜单项：
- 聊天 (💬)
- 设置 (⚙️)
- 历史 (📜)

**预期结果**:
- [ ] 所有窗口都能正常打开
- [ ] 所有窗口都有赛博朋克风格
- [ ] 窗口可以正常关闭
- [ ] 无控制台错误

**实际结果**: _____________

**备注**: _____________

---

## 🎨 测试 2: 主题切换功能

### 2.1 打开主题窗口
**步骤**:
1. 点击宠物打开菜单
2. 点击"主题"按钮
3. 观察主题窗口

**预期结果**:
- [ ] 主题窗口正常显示
- [ ] 显示两个主题卡片："赛博朋克" 和 "懒猫橘"
- [ ] 当前主题卡片显示 "✓ 当前主题" 徽章
- [ ] 预览区域正确显示主题颜色
- [ ] 无控制台错误

**实际结果**: _____________

**备注**: _____________

### 2.2 切换到赛博朋克主题
**步骤**:
1. 确认当前不是赛博朋克主题
2. 点击"赛博朋克"主题卡片
3. 观察变化

**预期结果**:
- [ ] 主题立即切换（无延迟）
- [ ] 所有窗口颜色更新：
  - 背景: 深蓝色 `#020810`
  - 主色: 霓虹青 `#00fff0`
  - 强调色: 品红 `#ff2d78`
- [ ] 主题卡片显示 "✓ 当前主题" 徽章
- [ ] 显示青色成功提示（2秒后消失）
- [ ] 控制台日志: `[ThemeWindow] selectTheme 调用，主题: cyberpunk`
- [ ] 控制台日志: `[ThemeWindow] 主题已保存: cyberpunk`

**实际结果**: _____________

**备注**: _____________

### 2.3 切换到懒猫橘主题
**步骤**:
1. 点击"懒猫橘"主题卡片
2. 观察变化

**预期结果**:
- [ ] 主题立即切换
- [ ] 所有窗口颜色更新：
  - 背景: 深暖棕 `#1a0e05`
  - 主色: 琥珀橙 `#ffb347`
  - 强调色: 橙红 `#ff6b35`
- [ ] 主题卡片显示 "✓ 当前主题" 徽章
- [ ] 显示青色成功提示
- [ ] 控制台日志正确

**实际结果**: _____________

**备注**: _____________

### 2.4 快速连续切换
**步骤**:
1. 快速点击"赛博朋克"
2. 立即点击"懒猫橘"
3. 再次点击"赛博朋克"

**预期结果**:
- [ ] 每次点击都能正确响应
- [ ] 无主题混乱
- [ ] 可能短暂显示加载状态
- [ ] 无控制台错误

**实际结果**: _____________

**备注**: _____________

---

## 🛡️ 测试 3: 错误处理测试

### 3.1 ThemeManager 不可用
**步骤**:
1. 打开主题窗口
2. 打开开发者工具 (F12)
3. 在控制台执行: `delete window.ThemeManager`
4. 点击任意主题卡片

**预期结果**:
- [ ] 显示品红色错误提示
- [ ] 错误消息: "主题管理器未加载，请刷新页面重试"
- [ ] 错误提示 3 秒后自动消失
- [ ] 控制台错误日志: `[ThemeWindow] ThemeManager 未定义！`
- [ ] 应用不崩溃

**实际结果**: _____________

**备注**: _____________

### 3.2 Electron API 不可用
**步骤**:
1. 在控制台执行: `delete window.electron`
2. 点击关闭按钮 (X)

**预期结果**:
- [ ] 显示错误提示
- [ ] 错误消息: "无法关闭窗口：API 不可用"
- [ ] 窗口不会关闭
- [ ] 控制台错误日志

**实际结果**: _____________

**备注**: _____________

### 3.3 刷新后恢复
**步骤**:
1. 在测试 3.1/3.2 后
2. 刷新页面 (Ctrl+R)
3. 重新打开主题窗口

**预期结果**:
- [ ] ThemeManager 自动恢复
- [ ] Electron API 自动恢复
- [ ] 所有功能正常
- [ ] 主题选择保持之前的设置

**实际结果**: _____________

**备注**: _____________

---

## 🎭 测试 4: UI/UX 测试

### 4.1 加载状态
**步骤**:
1. 打开主题窗口
2. 快速切换主题
3. 观察是否有加载提示

**预期结果**:
- [ ] 可能短暂显示 loading spinner
- [ ] 如果显示，应在主题切换后消失
- [ ] 加载文本: "正在加载主题..."
- [ ] 动画流畅

**实际结果**: _____________

**备注**: _____________

### 4.2 成功提示
**步骤**:
1. 切换到任意主题
2. 观察顶部提示

**预期结果**:
- [ ] 显示青色 toast
- [ ] 文本: "主题已切换"
- [ ] 滑入动画流畅
- [ ] 2 秒后自动消失
- [ ] 霓虹青色 `#00fff0`
- [ ] 发光效果

**实际结果**: _____________

**备注**: _____________

### 4.3 错误提示
**步骤**:
1. 触发错误（参考测试 3.1）
2. 观察错误提示

**预期结果**:
- [ ] 显示品红色 toast
- [ ] 霓虹脉冲动画
- [ ] 3 秒后自动消失
- [ ] 品红色 `#ff2d78`
- [ ] 错误信息清晰

**实际结果**: _____________

**备注**: _____________

### 4.4 主题卡片交互
**步骤**:
1. 悬停在主题卡片上
2. 点击主题卡片
3. 观察视觉反馈

**预期结果**:
- [ ] 悬停时:
  - 边框变亮
  - 轻微上移 (translateY -1px)
  - 发光效果
- [ ] 点击时:
  - 缩放效果 (scale 0.98)
  - 快速响应
- [ ] 激活状态:
  - 霓虹青边框
  - "✓ 当前主题" 徽章显示

**实际结果**: _____________

**备注**: _____________

---

## 🔄 测试 5: 跨窗口同步测试

### 5.1 多窗口主题同步
**步骤**:
1. 打开聊天窗口 (Ctrl+K)
2. 打开主题窗口
3. 切换到赛博朋克主题
4. 观察聊天窗口

**预期结果**:
- [ ] 聊天窗口颜色立即更新
- [ ] 背景变为深蓝色
- [ ] 按钮和边框变为霓虹青
- [ ] 无需刷新页面
- [ ] 无闪烁

**实际结果**: _____________

**备注**: _____________

### 5.2 持久化测试
**步骤**:
1. 切换到懒猫橘主题
2. 关闭所有窗口
3. 重启应用 (关闭后重新 npm start)
4. 观察主题

**预期结果**:
- [ ] 主题保持为懒猫橘
- [ ] 无需重新选择
- [ ] localStorage 中 `pet_theme` = "lazyCat"

**实际结果**: _____________

**备注**: _____________

---

## ⚡ 测试 6: 性能测试

### 6.1 事件委托验证
**步骤**:
1. 打开主题窗口
2. 打开开发者工具
3. 查看 Elements → Event Listeners

**预期结果**:
- [ ] `.theme-cards` 容器有 1 个 click 监听器
- [ ] 主题卡片本身没有 onclick 属性
- [ ] 关闭按钮没有 onclick 属性
- [ ] 事件委托正确实现

**实际结果**: _____________

**备注**: _____________

### 6.2 内存泄漏检查
**步骤**:
1. 打开主题窗口
2. 切换主题 10 次
3. 关闭主题窗口
4. 重复 5 次
5. 在开发者工具中查看内存使用

**预期结果**:
- [ ] 内存使用稳定
- [ ] 无明显内存增长
- [ ] 无 detached DOM 节点

**实际结果**: _____________

**备注**: _____________

### 6.3 控制台日志检查
**步骤**:
1. 执行所有测试
2. 查看控制台日志

**预期结果**:
- [ ] 无红色错误
- [ ] 日志清晰可读
- [ ] 关键操作都有日志:
  - `[ThemeWindow] 初始化开始`
  - `[ThemeWindow] 开始初始化`
  - `[ThemeWindow] ThemeManager 已就绪`
  - `[ThemeWindow] 事件委托已绑定`
  - `[ThemeWindow] 初始化完成`

**实际结果**: _____________

**备注**: _____________

---

## 🔧 测试 7: 边界情况测试

### 7.1 并发点击
**步骤**:
1. 快速双击主题卡片
2. 快速双击关闭按钮

**预期结果**:
- [ ] 无重复操作
- [ ] 无错误
- [ ] 响应正确

**实际结果**: _____________

**备注**: _____________

### 7.2 窗口拖动
**步骤**:
1. 打开主题窗口
2. 拖动窗口到屏幕边缘
3. 切换主题

**预期结果**:
- [ ] 主题正常切换
- [ ] 窗口位置不变
- [ ] 无视觉问题

**实际结果**: _____________

**备注**: _____________

### 7.3 快捷键测试
**步骤**:
1. 打开主题窗口
2. 按 Esc 键
3. 按 Ctrl+K 打开聊天
4. 在聊天窗口切换主题

**预期结果**:
- [ ] Esc 关闭主题窗口
- [ ] Ctrl+K 打开聊天
- [ ] 所有快捷键正常工作

**实际结果**: _____________

**备注**: _____________

---

## 📝 测试总结

### 通过的测试: _____ / _____

### 失败的测试:

| 测试编号 | 测试名称 | 问题描述 | 严重程度 |
|---------|---------|---------|---------|
|         |         |         |         |
|         |         |         |         |

### 发现的问题:

1. **问题描述**: _____________
   - **重现步骤**: _____________
   - **严重程度**: 🔴 高 / 🟡 中 / 🟢 低
   - **建议修复**: _____________

2. **问题描述**: _____________
   - **重现步骤**: _____________
   - **严重程度**: 🔴 高 / 🟡 中 / 🟢 低
   - **建议修复**: _____________

### 总体评价:

- [ ] ✅ 所有功能正常，可以发布
- [ ] ⚠️ 有小问题，建议修复后发布
- [ ] ❌ 有严重问题，必须修复后发布

### 测试人员签名: _____________

### 测试日期: _____________

---

## 📸 附件（可选）

- 截图主题窗口
- 截图控制台日志
- 截图错误提示
- 录制主题切换过程

---

## 🐛 调试 API

在控制台可用的调试 API：

```javascript
// 查看当前状态
window.ThemeWindowAPI.getState()

// 手动切换主题
window.ThemeWindowAPI.selectTheme('cyberpunk')
window.ThemeWindowAPI.selectTheme('lazyCat')

// 更新激活卡片
window.ThemeWindowAPI.updateActiveCard()

// 关闭窗口
window.ThemeWindowAPI.closeWindow()
```

---

**最后更新**: 2026-02-11
**文档版本**: 1.0
