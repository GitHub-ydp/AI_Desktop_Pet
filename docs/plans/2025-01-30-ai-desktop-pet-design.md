# AI桌面宠物 - 设计文档

**日期：** 2025-01-30
**项目类型：** Electron桌面应用 + AI对话
**核心定位：** 简单、有趣、有AI陪伴功能的桌面宠物

---

## 一、项目概述

### 1.1 核心理念
一个简单易用的AI桌面宠物应用，类似QQ宠物的现代化版本。用户在桌面上养一个可爱的宠物，它可以和用户对话、理解用户情绪、提供陪伴。

### 1.2 核心特性
- **极简设计**：Emoji宠物形象，无需复杂素材
- **智能对话**：基于AI的自然语言对话能力
- **多性格系统**：4种可选性格，满足不同偏好
- **桌面体验**：真正的桌面悬浮宠物，非网页版
- **零门槛使用**：免登录、打开即用

---

## 二、技术架构

### 2.1 技术栈
| 层级 | 技术选型 | 说明 |
|------|---------|------|
| 前端框架 | Vue 3 | 轻量、易上手 |
| 桌面框架 | Electron | 真正的桌面应用体验 |
| 样式方案 | Tailwind CSS | 快速开发 |
| AI引擎 | DeepSeek API | 免费额度大、性价比高 |
| 数据存储 | LocalStorage | 本地存储、隐私保护 |
| 打包工具 | electron-builder | 跨平台打包 |

### 2.2 核心数据结构

**宠物状态 (pet_data)**
```javascript
{
  emoji: "🐱",           // 当前宠物形象
  personality: "healing", // 当前性格
  mood: 80,              // 心情值 0-100
  lastInteraction: timestamp // 最后互动时间
}
```

**对话历史 (chat_history)**
```javascript
[
  {
    role: "user",
    content: "你好",
    timestamp: 1706600000000
  },
  {
    role: "assistant",
    content: "主人你好呀~",
    timestamp: 1706600005000
  }
]
```

**用户设置 (settings)**
```javascript
{
  autoSpeak: true,      // 主动说话开关
  personality: "healing", // 当前性格
  selectedPet: "🐱"      // 当前宠物
}
```

---

## 三、功能设计

### 3.1 宠物形象系统
- **可选宠物**：🐱🐶🐰🦊🐻（5种Emoji）
- **默认宠物**：🐱
- **动画效果**：
  - 呼吸动画：轻微缩放（1.0 ↔ 1.05）
  - 点击反馈：放大1.2倍
  - 心情低落：emoji变为😿

### 3.2 对话系统
**两种对话模式：**

1. **用户主动对话**
   - 点击宠物 → 弹出输入框
   - 用户输入 → AI回复
   - 保存到历史记录
   - 心情值 +5

2. **宠物主动说话**
   - 定时触发（30-60秒随机）
   - 根据性格随机选择语料
   - 气泡显示3秒后自动消失
   - 需满足：心情值 > 60 且 开关开启

### 3.3 四种性格系统

#### A. 治愈陪伴型（默认）
- **特点**：温柔体贴、关心情绪
- **适用场景**：需要情感陪伴的用户
- **回复风格**：简短（20字内）、温暖、可带emoji
- **示例**：
  - 用户："今天好累啊"
  - 宠物："主人辛苦啦~摸摸头💕要不要休息一下呢？"

#### B. 搞笑逗比型
- **特点**：幽默风趣、爱讲段子
- **适用场景**：想要轻松娱乐的用户
- **回复风格**：活泼（30字内）、搞笑、梗多
- **示例**：
  - 用户："今天好累啊"
  - 宠物："打工人实惨！来，给你讲个笑话提提神..."

#### C. 毒舌傲娇型
- **特点**：嘴硬心软、傲娇可爱
- **适用场景**：喜欢傲娇人设的用户
- **回复风格**：傲娇（25字内）、表面不在意实际关心
- **示例**：
  - 用户："今天好累啊"
  - 宠物："哼、谁让你工作那么拼...才不是担心你呢！快点休息啦！"

#### D. 贴心助理型
- **特点**：专业高效、实用主义
- **适用场景**：需要效率工具的用户
- **回复风格**：简洁（30字内）、实用、可操作
- **示例**：
  - 用户："今天好累啊"
  - 宠物："了解。建议现在休息15分钟，3点后继续工作。需要设置提醒吗？"

### 3.4 心情值系统
- **初始值**：80分
- **增加**：用户对话 +5分（上限100）
- **减少**：2小时无互动 -10分
- **影响**：
  - 高心情（>60）：正常回复、emoji正常
  - 低心情（≤60）：回复简短、emoji变为😿

### 3.5 数据持久化
- **存储位置**：LocalStorage
- **保存内容**：
  - 宠物状态（形象、性格、心情）
  - 对话历史（永久保存）
  - 用户设置
- **导出功能**：可导出历史记录为文本

---

## 四、UI/UX设计

### 4.1 界面布局
```
┌─────────────────────┐
│  [心情]  [设置] ⚙️  │  ← 右上角状态栏
│                     │
│         ╱╲         │
│        ╱  ╲        │  ← Emoji宠物（呼吸动画）
│        │  │        │
│        ╲  ╱        │
│         ╲╱         │
│      ┌─────┐       │
│      │你好！│      │  ← 气泡对话框
│       └───┘       │
│                     │
│  [对话历史] [设置] │  ← 底部功能按钮
└─────────────────────┘
```

### 4.2 窗口特性
- **尺寸**：300x400px
- **透明背景**：只显示宠物和UI元素
- **始终置顶**：不会被其他窗口遮挡
- **可拖拽**：拖动宠物移动窗口位置
- **无边框**：无标题栏、无关闭按钮

### 4.3 设置面板
- 切换宠物：5种Emoji可选
- 切换性格：4种性格单选
- 主动说话开关：开启/关闭
- 清空数据：清空历史记录和重置状态
- 退出程序：安全退出

### 4.4 颜色方案
- **背景**：透明或渐变（浅粉→浅蓝）
- **气泡**：白色 + 轻微阴影
- **文字**：深灰 #333
- **按钮**：浅灰 hover时加深

---

## 五、Electron桌面集成

### 5.1 窗口配置
```javascript
// main.js
const win = new BrowserWindow({
  width: 300,
  height: 400,
  frame: false,           // 无边框
  transparent: true,      // 透明背景
  alwaysOnTop: true,      // 始终置顶
  skipTaskbar: false,     // 显示在任务栏
  resizable: false,       // 不可调整大小
  webPreferences: {
    nodeIntegration: true,
    contextIsolation: false
  }
});
```

### 5.2 桌面特性
- ✅ **透明窗口**：只显示宠物元素
- ✅ **窗口拖拽**：鼠标拖动宠物移动位置
- ✅ **系统托盘**：最小化到托盘图标
- ✅ **开机自启**：支持开机自动启动
- ✅ **右键菜单**：显示/隐藏/退出

### 5.3 打包配置
```json
// package.json
{
  "name": "ai-desktop-pet",
  "version": "1.0.0",
  "main": "main.js",
  "scripts": {
    "start": "electron .",
    "build": "electron-builder"
  },
  "build": {
    "appId": "com.ai.desktop.pet",
    "win": {
      "target": "nsis",
      "icon": "build/icon.ico"
    }
  }
}
```

---

## 六、AI集成设计

### 6.1 API选择：DeepSeek
- **免费额度**：新用户500万tokens
- **价格**：后续 ¥1/百万tokens
- **优势**：中文友好、性价比高、API简单

### 6.2 API调用流程
```javascript
async function chatWithAI(message, personality, history) {
  const systemPrompt = getPersonalityPrompt(personality);

  const response = await fetch('https://api.deepseek.com/v1/chat', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${API_KEY}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      model: 'deepseek-chat',
      messages: [
        { role: 'system', content: systemPrompt },
        ...history.slice(-10),  // 最近10条历史
        { role: 'user', content: message }
      ],
      max_tokens: 100
    })
  });

  return response.choices[0].message.content;
}
```

### 6.3 主动说话语料库
每个性格预置20-30条语料，定期随机触发：

**治愈型示例：**
- "主人~陪我玩会吧💕"
- "记得喝水哦~"
- "你今天看起来不错呀！"
- "辛苦啦，休息一下吧~"

**搞笑型示例：**
- "震惊！你家宠物竟然会说话！"
- "来对暗号：天王盖地虎？"
- "今日瓜报：..."

---

## 七、文件结构

```
ai-desktop-pet/
├── main.js              # Electron主进程
├── preload.js           # 预加载脚本
├── package.json         # 项目配置
├── index.html           # 主页面
├── src/
│   ├── app.js           # Vue应用入口
│   ├── components/
│   │   ├── Pet.js       # 宠物组件
│   │   ├── Bubble.js    # 气泡对话框
│   │   └── Settings.js  # 设置面板
│   ├── api.js           # AI API调用
│   ├── storage.js       # 本地存储管理
│   ├── prompts.js       # 性格prompt
│   └── utils.js         # 工具函数
├── assets/
│   └── icon.png         # 应用图标
└── build/
    └── icon.ico         # Windows图标
```

---

## 八、开发计划

### Phase 1: 基础框架（1天）
- [x] 搭建Electron + Vue项目
- [x] 配置透明窗口和基础样式
- [x] 实现宠物显示和点击交互

### Phase 2: AI对话（1天）
- [x] 集成DeepSeek API
- [x] 实现4种性格prompt
- [x] 对话历史存储和展示

### Phase 3: 状态系统（1天）
- [x] 实现心情值系统
- [x] 主动说话定时器
- [x] 宠物形象切换

### Phase 4: 桌面特性（1天）
- [x] 窗口拖拽功能
- [x] 系统托盘集成
- [x] 开机自启配置

### Phase 5: 打包发布（1天）
- [x] 配置electron-builder
- [x] 生成Windows安装包
- [x] 测试和优化

**预计总工时：4-5天**

---

## 九、后续迭代方向

### V1.1 规划
- [ ] 增加更多宠物形象（自定义图片上传）
- [ ] 语音对话功能（语音识别+TTS）
- [ ] 更多互动玩法（摸摸头、喂食等）

### V1.2 规划
- [ ] 云端同步（登录账号、多设备同步）
- [ ] 社区分享（有趣的对话分享）
- [ ] 宠物进化系统（根据互动等级解锁新特性）

### V2.0 规划
- [ ] 多个宠物同时养
- [ ] 宠物之间的互动
- [ ] 插件系统（第三方扩展）

---

## 十、风险和注意事项

### 10.1 技术风险
- **API稳定性**：DeepSeek API可能不稳定，需做好降级方案
- **性能问题**：定时器过多可能影响性能，需优化
- **内存占用**：长期运行可能内存泄漏，需测试

### 10.2 合规风险
- **AI内容安全**：需对AI回复进行内容审核
- **用户隐私**：本地存储也需注意加密敏感信息
- **图标版权**：使用开源或自研图标，避免侵权

### 10.3 用户体验
- **CPU占用**：透明窗口和动画可能导致CPU占用高
- **电池影响**：笔记本用户关注电池续航
- **兼容性**：Windows/Mac/Linux表现可能不同

---

## 十一、成功指标

### 用户指标
- 下载量 > 1000（首月）
- 日活率 > 30%
- 用户对话数 > 10次/天

### 技术指标
- 应用崩溃率 < 1%
- API响应时间 < 2秒
- 内存占用 < 100MB

### 商业指标
- 用户留存率（次日）> 40%
- 用户推荐意愿 > 60%
- 付费转化率（V1.1后）

---

**文档版本：** v1.0
**最后更新：** 2025-01-30
**维护者：** Claude Code
