<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Desktop Pet</title>
  <link rel="stylesheet" href="src/style.css">
</head>
<body>
  <div id="app">
    <!-- å¯¹è¯æ°”æ³¡ -->
    <div class="chat-bubble" id="chatBubble" style="display: none;">
      <div class="bubble-content" id="bubbleMessage"></div>
      <div class="bubble-arrow"></div>
    </div>

    <!-- å® ç‰© -->
    <div class="pet-wrapper" id="petWrapper">
      <div class="pet-lottie" id="petLottie"></div>
      <div class="pet-emoji" id="petEmoji" style="display: none;">ğŸ±</div>
    </div>

    <!-- å¿«æ·èœå• -->
    <div class="quick-menu" id="quickMenu" style="display: none;">
      <div class="quick-menu-item" onclick="openChat()" title="å¯¹è¯">ğŸ’¬</div>
      <div class="quick-menu-item" onclick="openSettings()" title="è®¾ç½®">âš™ï¸</div>
      <div class="quick-menu-item" onclick="openHistory()" title="å†å²">ğŸ“œ</div>
      <div class="quick-menu-item" onclick="closeQuickMenu()" title="å…³é—­">âŒ</div>
    </div>
  </div>

  <!-- Lottie åŠ¨ç”»åº“ -->
  <script src="assets/lib/lottie.min.js"></script>
  
  <script src="src/storage.js"></script>
  <script src="src/prompts.js"></script>
  <script src="src/api.js"></script>
  <script src="fix-memory.js"></script>
  <script src="src/reminder-extractor.js"></script>
  <script src="src/lottie-controller.js"></script>
  <script src="src/animations.js"></script>
  <script src="src/rotary-menu.js"></script>
  <script src="src/app-vanilla.js"></script>

  <!-- å·¥å…·ç³»ç»Ÿæµ‹è¯•è„šæœ¬ - æŒ‰ Ctrl+Shift+I æ‰“å¼€æ§åˆ¶å°æŸ¥çœ‹ -->
  <script>
    // å»¶è¿Ÿæ‰§è¡Œï¼Œç¡®ä¿æ‰€æœ‰APIéƒ½å·²åŠ è½½
    setTimeout(async () => {
      console.log('\n[TOOL] å·¥å…·ç³»ç»Ÿæµ‹è¯•å¼€å§‹\n');
      console.log('='.repeat(60));

      // æµ‹è¯•1: æ£€æŸ¥API
      console.log('[TEST] æµ‹è¯•1: æ£€æŸ¥ PetTools API');
      if (typeof window.PetTools === 'undefined') {
        console.error('[ERROR] PetTools API æœªæ‰¾åˆ°ï¼');
        console.log('è¯·æ£€æŸ¥ï¼š');
        console.log('1. åº”ç”¨æ˜¯å¦å®Œå…¨å¯åŠ¨ï¼Ÿ');
        console.log('2. preload.js æ˜¯å¦æ­£ç¡®é…ç½®ï¼Ÿ');
        console.log('3. ä¸»è¿›ç¨‹å·¥å…·ç³»ç»Ÿæ˜¯å¦åˆå§‹åŒ–æˆåŠŸï¼Ÿ');
      } else {
        console.log('[OK] PetTools API å·²åŠ è½½');

        // æµ‹è¯•2: åˆ—å‡ºå·¥å…·
        console.log('\n[TEST] æµ‹è¯•2: åˆ—å‡ºæ‰€æœ‰å·¥å…·');
        try {
          const tools = await window.PetTools.list();
          console.log(`[OK] æ‰¾åˆ° ${tools.length} ä¸ªå·¥å…·:`);
          tools.forEach(tool => {
            const safe = tool.safe ? '[SAFE]' : '[WARN]';
            const approval = tool.requiresApproval ? '[LOCK]' : '[OPEN]';
            console.log(`  ${safe} ${approval} ${tool.name} - ${tool.description}`);
          });

          // æµ‹è¯•3: æ‰§è¡Œå·¥å…·
          console.log('\n[TEST] æµ‹è¯•3: æ‰§è¡Œ system.info');
          const result = await window.PetTools.execute('system.info', {
            info_type: 'all'
          });
          if (result.success) {
            console.log('[OK] æ‰§è¡ŒæˆåŠŸï¼');
            console.log(`  OS: ${result.result.os.platform} ${result.result.os.release}`);
            console.log(`  CPU: ${result.result.cpu.cores} æ ¸å¿ƒ`);
            console.log(`  å†…å­˜: ${result.result.memory.total}`);
          } else {
            console.error('[ERROR] æ‰§è¡Œå¤±è´¥:', result.error);
          }

          // æµ‹è¯•4: æŸ¥çœ‹å†å²
          console.log('\n[TEST] æµ‹è¯•4: æŸ¥çœ‹æ‰§è¡Œå†å²');
          const history = await window.PetTools.getHistory({ limit: 5 });
          console.log(`[OK] æ‰¾åˆ° ${history.length} æ¡è®°å½•`);

          console.log('\n' + '='.repeat(60));
          console.log('[SUCCESS] æ‰€æœ‰æµ‹è¯•å®Œæˆï¼å·¥å…·ç³»ç»Ÿå·¥ä½œæ­£å¸¸ï¼');
          console.log('\n[TIP] ä½ å¯ä»¥ç»§ç»­æµ‹è¯•ï¼š');
          console.log('- window.PetTools.list()');
          console.log('- window.PetTools.execute("system.uptime", {})');
          console.log('- window.PetTools.getHistory()');
        } catch (error) {
          console.error('[ERROR] æµ‹è¯•å¤±è´¥:', error.message);
        }
      }
      console.log('');
    }, 2000);
  </script>
</body>
</html>
